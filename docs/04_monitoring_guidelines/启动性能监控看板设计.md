# APM 启动性能监控看板设计 V1.0

**版本**: 1.0
**日期**: [请替换为当前日期]
**设计者**: [你的名字/AI]

## 1. 概述

本文档描述了一个用于监控 iOS 应用线上启动性能的 APM (Application Performance Monitoring) 看板 (Dashboard) 的设计方案。目标是提供一个清晰、全面的视图，帮助开发和运维团队了解真实用户的启动体验、追踪性能变化、快速定位潜在问题。

**看板受众**: iOS 开发团队、QA 团队、运维/SRE 团队、产品经理。

**数据来源**: 应用内 `LaunchTimeReporter` 上报到 APM 后端的启动耗时数据（指标和维度），可能结合 APM 系统自带的其他指标（如崩溃率、网络请求等）。参考 `docs/01_measurement/APM 集成说明-启动时间篇.md` 中定义的数据结构。

**核心原则**:
*   **概览优先**: 首先展示核心指标的整体趋势。
*   **多维下钻**: 支持按关键维度（版本、系统、设备等）进行筛选和分组。
*   **关联分析**: 将启动性能与其他关键指标（如崩溃率、用户留存）关联展示（如果 APM 支持）。
*   **可定制性**: 设计应考虑不同角色的关注点，允许一定程度的定制。

## 2. 看板布局与关键图表

以下是一个建议的看板布局和包含的关键图表/组件。具体实现需根据 APM 平台能力调整。

**看板名称**: iOS App 启动性能监控

**时间范围选择器**: 提供常用时间范围选择（例如：过去 1 小时、24 小时、7 天、30 天，以及自定义范围）。

**全局筛选器**:
*   **App 版本**: 支持选择单个或多个版本进行对比。
*   **iOS 系统版本**: 支持选择单个或多个系统版本。
*   **设备型号**: 支持选择或分组查看不同设备型号。
*   **(可选) 网络类型**: (如果上报了) WiFi / Cellular。
*   **(可选) 地域**: (如果 APM 支持)。
*   **(可选) 用户分群**: (如果 APM 支持)。

---

**第一行：核心指标概览 (Overview)**

*   **图表 1: 应用层总启动耗时 (T5-T2) P90/P50 时间序列图**
    *   **类型**: 折线图 (Line Chart)
    *   **Y 轴**: 耗时 (毫秒, ms)
    *   **X 轴**: 时间
    *   **数据**: 展示 T5-T2 (total_main_ms) 的 P90 和 P50 分位数随时间的变化趋势。P90 反映较差情况，P50 反映普遍情况。
    *   **对比**: 可选与上一个周期对比线。
*   **图表 2: Pre-main 耗时 (估算) P90/P50 时间序列图**
    *   **类型**: 折线图
    *   **Y 轴**: 耗时 (毫秒, ms)
    *   **X 轴**: 时间
    *   **数据**: 展示 Pre-main 耗时（如果可以通过 MetricKit 或其他方式采集并上报）的 P90/P50 趋势。如果无法直接采集，此图表可省略或用其他指标替代。
*   **图表 3: 启动成功率 (可选，需定义)**
    *   **类型**: 折线图 或 单值 (Single Stat) + 趋势
    *   **Y 轴**: 百分比 (%)
    *   **X 轴**: 时间
    *   **数据**: 定义一个"成功启动"的标准（例如：T5 时间点成功记录），计算 `成功启动次数 / 总启动次数`。需要 APM 支持计数或事件。
*   **图表 4: 启动期间崩溃率 (可选，需 APM 支持)**
    *   **类型**: 折线图 或 单值 + 趋势
    *   **Y 轴**: 百分比 (%)
    *   **X 轴**: 时间
    *   **数据**: 关联 APM 的崩溃监控数据，计算启动阶段（例如 T0-T5 之间）发生的崩溃占总启动次数的比例。

---

**第二行：启动阶段耗时分解 (Breakdown)**

*   **图表 5: 各阶段平均耗时堆叠面积图 (按版本)**
    *   **类型**: 堆叠面积图 (Stacked Area Chart)
    *   **Y 轴**: 耗时 (毫秒, ms)
    *   **X 轴**: 时间 (或 App 版本)
    *   **数据**: 将 `main_prepare_ms`, `did_finish_launch_ms`, `first_frame_prepare_ms` 堆叠显示，总高度即为 `total_main_ms` 的平均值。
    *   **分组/颜色**: 按不同的启动阶段区分颜色。
    *   **目的**: 直观展示总耗时中各主要阶段的占比及其变化趋势。
*   **图表 6: 各阶段耗时 P90 分布 (按 App 版本)**
    *   **类型**: 分组柱状图 (Grouped Bar Chart) 或 箱线图 (Box Plot)
    *   **Y 轴**: 耗时 (毫秒, ms)
    *   **X 轴**: App 版本
    *   **数据**: 对比不同 App 版本下，`main_prepare_ms`, `did_finish_launch_ms`, `first_frame_prepare_ms` 的 P90 值。
    *   **目的**: 快速定位哪个阶段、哪个版本的 P90 耗时较高。

---

**第三行：维度下钻分析 (Dimension Drill-down)**

*   **图表 7: Top N 慢启动设备型号 (按 T5-T2 P90 排序)**
    *   **类型**: 表格 (Table) 或 水平柱状图 (Horizontal Bar Chart)
    *   **列/数据**: 设备型号 (`device_model`), 平均 T5-T2 (ms), P90 T5-T2 (ms), 启动次数。
    *   **排序**: 按 P90 T5-T2 降序排列。
    *   **目的**: 识别启动最慢的设备类型，可能与设备性能或特定适配问题有关。
*   **图表 8: Top N 慢启动 iOS 版本 (按 T5-T2 P90 排序)**
    *   **类型**: 表格 或 水平柱状图
    *   **列/数据**: iOS 系统版本 (`os_version`), 平均 T5-T2 (ms), P90 T5-T2 (ms), 启动次数。
    *   **排序**: 按 P90 T5-T2 降序排列。
    *   **目的**: 识别在哪些系统版本上启动较慢，可能与系统兼容性有关。
*   **图表 9: 不同 App 版本启动耗时对比 (T5-T2 P50/P90)**
    *   **类型**: 表格 或 分组柱状图
    *   **列/数据**: App 版本 (`app_version`), P50 T5-T2 (ms), P90 T5-T2 (ms), 启动次数。
    *   **排序**: 按 App 版本号降序排列。
    *   **目的**: 清晰对比不同版本间的性能变化。

---

**(可选) 第四行：与其他指标关联**

*   **图表 10: 启动耗时与后续崩溃率关系 (散点图/分桶)**
    *   **类型**: 散点图 或 分桶柱状图
    *   **X 轴**: 启动耗时 (T5-T2) 分桶 (e.g., 0-1s, 1-2s, 2-3s, >3s)
    *   **Y 轴**: 对应启动耗时分桶内的会话崩溃率。
    *   **目的**: 分析启动慢是否与后续使用过程中的稳定性下降有关。
*   **图表 11: 启动耗时与用户留存率关系 (需 APM 或数据平台支持)**
    *   **类型**: 折线图 或 表格
    *   **X 轴**: 启动耗时分桶
    *   **Y 轴**: 次日留存率 / 7日留存率
    *   **目的**: 分析启动性能对用户留存的影响。

## 3. 配置与维护

*   **数据精度**: 确保上报的耗时数据单位统一（例如毫秒）。
*   **维度完整性**: 确保上报了进行分析所需的关键维度（版本、系统、设备等）。
*   **定期审阅**: 定期（例如每周）检查看板数据，关注趋势变化和异常点。
*   **迭代优化**: 根据使用反馈和新的分析需求，持续调整和优化看板的布局与图表。
*   **告警联动**: (如果 APM 支持) 基于看板上的关键指标（例如 P90 耗时突增）配置告警规则，及时通知相关人员。

## 4. 版本修订

| 版本 | 日期       | 修订者     | 说明                     |
| ---- | ---------- | ---------- | ------------------------ |
| 1.0  | [今天日期] | [你的名字/AI] | 初版创建，定义看板布局和关键图表 |

</rewritten_file> 